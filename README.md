# de-project-bibip


## Настройка среды разработки

Рекомендуем использовать редактор [Visual Studio Code](https://code.visualstudio.com/).

vscode при запуске импортируем переменные среды из файла `.env` и запускаем отладку.

Чтобы в редакторе работала подсветка импортов, а при запуске все зависимости корректно подтягивались, создайте файл `.env` в корне проекта и добавьте в него следующие строки:
```bash
PYTHONPATH="$PYTHONPATH:full_path_to_src_folder_in_project"
```
где full_path_to_src_folder_in_project - полный путь до каталога src.

Этой командой вы добавляете каталог src в переменную окружения PYTHONPATH, чтобы python мог найти все модули в проекте.

После того, как вы создали файл `.env`, перезапустите vscode. Все импорты должны подсвечиваться корректно.


## Запуск тестов в консоли

Если вы хотите запустить тесты в консоли, вам так же нужно добавить переменную окружения PYTHONPATH. Для этого выполните следующие команды:
```bash
export PYTHONPATH=$PYTHONPATH:full_path_to_src_folder_in_project
```
где full_path_to_src_folder_in_project - полный путь до каталога src.

После этого вы можете запустить тесты:
```bash
cd de-project-bibip # переходим в каталог проекта
pytest tests # запускаем тесты
```

## Запуск проекта в докере

Если вы не сталкивались с докером, просто проигнорируйте файлы `Dockerfile` и `docker-compose.yml`. Вы еще познакомитесь с докером, дальше на курсе.

Если вы предпочитаете разрабатывать в докере, то вам нужно выполнить следующие команды:
```bash
cd de-project-bibip
docker compose up -d --build
```

После завершения работы остановите контейнер:
```bash
docker compose down -v
```

Задание 1. Сохранение автомобилей и моделей
Ваша задача — написать код, который будет добавлять автомобили и модели в базу данных. При добавлении запись должна появляться сразу в двух файлах. 
Для автомобилей:
cars.txt
cars_index.txt
Для моделей:
models.txt
models_index.txt
Таким образом, при добавлении объекта, модели и машины, должны заполняться сразу оба файла. В следующих заданиях вы будете использовать данные из них.

Задание 2. Сохранение продаж
Состоялась новая продажа! Нужно не теряя времени реализовать запись о продаже в соответствующую таблицу. Вам понадобятся два файла:
sales.txt
sales_index.txt
Не забудьте, что в таблице cars необходимо изменить статус машины на sold.

Задание 3. Вывод машин, доступных к продаже
В приложение автосалона хотят добавить новую функцию для покупателей — выводить список моделей, доступных к покупке прямо сейчас. Иными словами, машины в статусе available. Реализуйте вывод списка, отсортируйте его по VIN-коду автомобиля.

адание 4. Вывод детальной информации
Менеджеры по продажам попросили добавить в своё приложение функцию, которая позволит выводить информацию о машине по VIN-коду. После ввода VIN-кода им было бы удобно видеть:
vin — VIN-код автомобиля,
model_name — марку автомобиля,
model_brand — бренд автомобиля (его нужно взять из model.brand),
price — закупочную стоимость,
date_start — дату поступления в продажу,
status — статус,
дату продажи, либо None, если машина ещё не продана,
цену продажи, либо None, если машина ещё не продана.

Задание 5. Обновление ключевого поля
При заполнении данных одной из машин, которую скоро должны поставить, менеджер опечатался, вводя VIN-код. Реализуйте функцию, которая исправит VIN-код на корректный. Помните, что vin — ключевое поле, по нему строится индекс. Это означает, что при обновлении необходимо будет перестроить и индекс.  

Задание 6. Удаление продажи
При бухгалтерской проверке обнаружилось, что одна из сделок в итоге не состоялась. Реализуйте функцию, которая удалит запись из таблицы продаж и заменит статус для машины.
Подсказка
В Python нет возможности удалить произвольную строку из файла. Вы можете либо добавить флаг is_deleted, а потом при чтении игнорировать такие строки, либо переписать файл целиком, сохранив только актуальные данные. 
К сожалению, удаление из БД — очень тяжёлая операция. Поэтому во многих компаниях предпочитают проставить специальный флаг вместо того, чтобы удалять данные по-настоящему.

Задание 7. Самые продаваемые модели
На главной странице приложения пользователь видит три самые популярные модели машин. Список отранжирован по количеству проданных моделей. Если количество продаж у моделей равно, то сначала выводятся более дорогие. Реализуйте вывод топ-3 моделей по количеству продаж в автосалоне.
В выдаче необходимо указать:
car_model_name — название модели,
brand — бренд производителя,
sales_count — количество продаж.
Подсказка
Это очереди аналитический запрос. Прочитайте файл и по ходу чтения заполните, например, словарь, где ключом будет id модели, а значением — количество продаж. После получения статистики выберите топ-3 модели и соберите информацию о них (название модели и бренд) по ключам.